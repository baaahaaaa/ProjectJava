<!-- src/main/resources/ranim/projetpidev/internship/map.html -->
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8"/>
    <title>Leaflet + Geocoder + Draggable Marker</title>
    <link rel="stylesheet"
          href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
    <link rel="stylesheet"
          href="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.css"/>
    <style> html, body, #map { height:100%; margin:0 } </style>
</head>
<body>
<div id="map"></div>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.js"></script>
<script>
    var map = L.map('map').setView([34.0, 9.0], 6);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{
        attribution:'&copy; OSM'
    }).addTo(map);

    var geocoder = L.Control.geocoder({ defaultMarkGeocode:false }).addTo(map);
    var marker;

    geocoder.on('markgeocode', function(e){
        var c = e.geocode.center;
        _placeMarker(c.lat, c.lng);
    });

    map.on('click', function(e){
        _placeMarker(e.latlng.lat, e.latlng.lng);
    });

    function _placeMarker(lat, lon){
        if(marker) map.removeLayer(marker);
        marker = L.marker([lat,lon], {draggable:true}).addTo(map);
        marker.on('dragend', function(ev){
            var p = ev.target.getLatLng();
            window.java.onMapClick(p.lat, p.lng);
        });
        window.java.onMapClick(lat, lon);
        map.setView([lat, lon], 14);
    }
</script>
</body>
</html>
